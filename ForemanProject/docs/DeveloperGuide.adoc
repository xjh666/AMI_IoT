= AddressBook Level 4 - Developer Guide
:toc:
:toc-title:
:toc-placement: preamble
:sectnums:
:imagesDir: images
ifdef::env-github[]
:tip-caption: :bulb:
:note-caption: :information_source:
endif::[]
ifdef::env-github,env-browser[:outfilesuffix: .adoc]
:repoURL: https://github.com/xjh666/AMI_IoT/tree/master

== Setting up

=== Prerequisites

. *JDK `1.8.0_60`* or later
. *Android Studio* IDE

=== Importing the project into Eclipse

.  Fork this repo, and clone the fork to your computer
.  Open Android Studio 
.  Click `File` > `New` >`Import Project...`
.  Locate the project's directory and select `ForemanProject`
.  Click `OK`

=== Troubleshooting project setup

* Problem: Android Studio reports compile errors after new commits are pulled from Git*

* Reason: Android Studio fails to recognize new files that appeared due to the Git pull.
* Solution: Refresh the project in Android Studio: Click `Build` > `Rebuild Project` 

=== Updating documentation

After forking the repo, links in the documentation will link to the wrong repo. You should replace the URL in the variable `repoURL` in DeveloperGuide.adoc with the URL of your fork.

== Design

=== UI component

==== Login Page

* link:{repoURL}/ForemanProject/app/src/main/java/com/example/foremanproject/activity/Login.java[`Login`] & link:{repoURL}/ForemanProject/app/src/main/res/layout/activity_login.xml[`activity_login`]
* This page is designed as an activity.
* The UI of this page is designed completely in the xml file.
* It is resposible for getting and storing the user's info

image::UI.png[height="400"]


==== Monitor Page

* This page is designed as an activity with three fragments for viewing dashboard, host list and host group list.
* The fragments are shown in the `content_frame` of link:{repoURL}/ForemanProject/app/src/main/res/layout/activity_monitorpage.xml[`activity_monitorpage`]
* The fragments are swtiched by the navigation drawer `nvView`

===== Dashboard

* The framework is designed in link:{repoURL}/ForemanProject/app/src/main/res/layout/fragment_dashboard.xml[`fragment_dashboard`]
* The content including the tables and graphs are set programmatically in link:{repoURL}/ForemanProject/app/src/main/java/com/example/foremanproject/fragment/Dashboard.java[`Dashboard`]
* The color code for the status table and the pie chart is in link:{repoURL}/ForemanProject/app/src/main/res/layout/colors.xml[`colors`]
* The grid of the Latest Event table is link:{repoURL}/ForemanProject/app/src/main/res/drawable/cell_shape.xml[`cell_shape`]

===== Host List

* For both fragment link:{repoURL}/ForemanProject/app/src/main/java/com/example/foremanproject/fragment/AllHosts.java[`AllHosts`] and activity link:{repoURL}/ForemanProject/app/src/main/java/com/example/foremanproject/activity/HostsOfAHostGroup.java[`HostsOfAHostGroup`]
* The content including the status icon, host name and `EDIT` button are set in the java file programmatically
* The framework is in link:{repoURL}/ForemanProject/app/src/main/res/layout/list.xml[`list`]

===== Host Group List

* The framework is designed in link:{repoURL}/ForemanProject/app/src/main/res/layout/list.xml[`list`]
* The content including host group name, `ALL` button and `EDIT` button are set programmatically in link:{repoURL}/ForemanProject/app/src/main/java/com/example/foremanproject/fragment/HostGroups.java[`HostGroups`]


==== Editing Page
* The framework is designed in link:{repoURL}/ForemanProject/app/src/main/res/layout/list.xml[`list`]
* The contents including puppet class name, original info icon, parameter name, value and two buttons are are set programmatically in link:{repoURL}/ForemanProject/app/src/main/java/com/example/foremanproject/activity/Parameters.java[`Parameters`]
* The popup window is link:{repoURL}/ForemanProject/app/src/main/java/com/example/foremanproject/activity/ParameterInfo.java[`ParameterInfo`], which is an activity with smaller size

=== Implementation

==== Network with foreman system
* As the security certificate of foreman url is not trusted by Android OS, link:{repoURL}/ForemanProject/app/src/main/java/com/example/foremanproject/other/NukeSSLCerts.java[`NukeSSLCerts`] is used to make the app trust all certificates
* Library link:https://developer.android.com/training/volley/index.html[Volley] is used for network tosend request to the foreman server.
* The url, username and password(for api and header of request) and screen size(used for flexible UI for different devices) is stored if login is successful in link:{repoURL}/ForemanProject/app/src/main/java/com/example/foremanproject/other/Configuration.java[`Configuration`]. 

==== Dashboard
* The pie chart and histogram is drawn by using link:http://achartengine.org/[AChartEngine]
* The fragment starts a repeating task with period of 30 seconds.
* `"GET /api/dashboard"` is used to get information related to Host Configuration Chart and Host Configuration Status
** This api returns a JSONObject containing the number of hosts in different status.
* `"GET /api/reports"` is used to get information related to Run Distribution in the last 30 minutes and Latest Events
** This api returns a JSONObject containing a list of reports within the past 40 minutes, which are in chronological order 

